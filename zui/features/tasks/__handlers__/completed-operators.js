// Generated by CoffeeScript 1.4.0
(function() {

  define(["jquery", "zui/coala/loader-plugin-manager"], function($, LoaderManager) {
    return {
      viewIt: function() {
        var app, grid, gridView, me, selected;
        me = this;
        grid = me.feature.views["completed-grid"].components[0];
        gridView = me.feature.views["completed-grid"];
        selected = grid.getGridParam("selrow");
        app = me.feature.module.getApplication().applicationRoot;
        if (!selected) {
          return app.info("请选择要操作的记录");
        }
        gridView.model.set("id", selected);
        $.when(gridView.model.fetch()).done(function() {
          return LoaderManager.invoke("view", me.feature.module, me.feature, "forms:" + selected).done(function(view) {
            view.model = gridView.model;
            return app.showDialog({
              view: view,
              title: "Task Process",
              buttons: [
                {
                  label: "Revoke",
                  fn: function() {
                    return me.feature.request({
                      url: "revoke/" + selected
                    }).done(function() {
                      return grid.trigger("reloadGrid");
                    });
                  }
                }
              ]
            });
          });
        });
        return true;
      }
    };
  });

}).call(this);
